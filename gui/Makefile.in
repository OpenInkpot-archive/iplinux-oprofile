prefix=$(DESTDIR)@prefix@
exec_prefix=@exec_prefix@
BINDIR=@bindir@
MKDIR_P=mkdir -p
MOC=@MOC@
UIC=@UIC@

CXX=@CXX@

CXXFLAGS=-Wall -pedantic -W @CXXFLAGS@ -I@KINC@ @QT2_INCLUDES@

# FIXME: dependencies are fucked ... my fault (john)

.PHONY: all clean install uninstall
.SUFFIXES:

ifeq "@have_qt2@" "yes"
all: oprof_start

clean:
	$(MAKE) -C ui clean
	rm -f *.o *.moc.* oprof_start

install: all oprof_start
	-$(MKDIR_P) $(BINDIR)
	cp oprof_start $(BINDIR)/oprof_start && chmod 755 $(BINDIR)/oprof_start

uninstall:
	-rm -f $(BINDIR)/oprof_start
	@echo "---------------------------------------------------------------"
	@echo "The uninstall target does not remove your ~/.oprofile directory"
	@echo "---------------------------------------------------------------"

UISOURCES=ui/oprof_start.base.o ui/oprof_start.base.moc.o
SOURCES=oprof_start.o oprof_start.moc.o ../events/op_events.o \
 ../events/op_events_desc.o oprof_start_config.o oprof_start_main.o \
 oprof_start_util.o ../util/string_manip.o ../util/child_reader.o ../util/file_manip.o

oprof_start: $(SOURCES)
	$(MAKE) -C ui
	$(CXX) $(CXXFLAGS) -o $@ $^ $(UISOURCES) @QT2_LDFLAGS@ @QT2_LIBS@ -liberty

ui/oprof_start.base.h:
	$(MAKE) -C ui

oprof_start.moc.o: oprof_start.moc.cpp oprof_start.h \
 ui/oprof_start.base.h oprof_start_config.h persistent_config.h \
 ../op_user.h ../version.h
	$(CXX) $(CXXFLAGS) -c $< -o $@
oprof_start.o: oprof_start.cpp oprof_start.h ui/oprof_start.base.h \
 oprof_start_config.h persistent_config.h ../op_user.h ../version.h ../util/string_manip.h
	$(CXX) $(CXXFLAGS) -c $< -o $@
oprof_start_config.o: oprof_start_config.cpp oprof_start_config.h \
 persistent_config.h ../op_user.h ../version.h
	$(CXX) $(CXXFLAGS) -c $< -o $@
oprof_start_util.o: oprof_start_util.cpp oprof_start_util.h ../util/string_manip.h ../util/child_reader.h ../util/file_manip.h
	$(CXX) $(CXXFLAGS) -c $< -o $@
oprof_start_main.o: oprof_start_main.cpp oprof_start.h \
 ui/oprof_start.base.h oprof_start_config.h persistent_config.h \
 ../op_user.h ../version.h            
	$(CXX) $(CXXFLAGS) -c $< -o $@

# generate qt moc code for subclass
oprof_start.moc.cpp: oprof_start.h ui/oprof_start.base.moc.cpp
	$(MOC) -o oprof_start.moc.cpp oprof_start.h

else
all:
clean:
install:
uninstall:
endif
