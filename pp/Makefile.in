INSTALL_LIST=oprofpp oprof_convert op_to_source op_time

CFLAGS=@CFLAGS@ -Wall -W -Wstrict-prototypes -Wunused -Wshadow -Wmissing-prototypes -Winline
CXXFLAGS=@CXXFLAGS@ @BFD_CXXFLAGS@ -Wall -W -Wunused -Wmissing-prototypes
LIBS=-lpopt -lbfd -liberty -ldl
MY_SOURCES=oprofpp.cpp oprofpp_util.cpp
OBJS=../events/op_events.o ../events/op_events_desc.o ../dae/opd_util.o oprofpp_util.o ../op_popt.o

all: $(INSTALL_LIST)

.PHONY: all clean srcdoc install uninstall

clean: 
	rm -f *.o *.d oprofpp-src.html $(INSTALL_LIST)

install: all
	-$(MKDIR_P) $(BINDIR)
	for f in $(INSTALL_LIST); do \
		cp $$f $(BINDIR)/$$f && chmod 755 $(BINDIR)/$$f; \
	done

uninstall:
	for f in $(INSTALL_LIST); do \
		rm -f $(BINDIR)/$$f; \
	done

srcdoc: oprofpp-src.html

oprofpp-src.html: $(MY_SOURCES)
	../scripts/dodoc -html $(MY_SOURCES) >oprofpp-src.html

oprofpp: oprofpp.o $(OBJS)
	$(CXX) $(CXXFLAGS) $(INCLUDES) -o $@ oprofpp.o $(OBJS) $(LIBS)

oprof_convert: oprof_convert.c ../dae/opd_util.c ../dae/opd_util.h ../op_user.h
	$(CC) $(CFLAGS) oprof_convert.c ../dae/opd_util.c -o $@ $(LIBS)

op_to_source: opf_filter.o opf_container.o ../util/child_reader.o $(OBJS) \
 ../util/string_manip.o ../util/file_manip.o $(LIBS)
	$(CXX) $(CXXFLAGS) $^ -o $@

op_time: op_time.o ../util/file_manip.o $(OBJS)
	$(CXX) $(CXXFLAGS) $^ -o $@ $(LIBS)

%.o: %c
	$(CC) -c $(CFLAGS) $(INCLUDES) -g $< -o $@

%.o: %cpp
	$(CXX) -c $(CXXFLAGS) $(INCLUDES) -g $< -o $@

ALL_SOURCES = oprofpp.cpp oprofpp_util.cpp opf_container.cpp opf_filter.cpp oprof_convert.c op_time.cpp

include ../Rules.make
