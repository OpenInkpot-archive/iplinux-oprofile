# $Id$

.PHONY: all clean srcdoc install uninstall

all: oprofiled

prefix=$(DESTDIR)@prefix@
exec_prefix=@exec_prefix@
BINDIR=@bindir@
MANDIR=@mandir@
CC=@CC@
MKDIR_P=mkdir -p
INSTALL_LIST=oprofiled op_start op_dump op_stop

install: all $(INSTALL_LIST)
	-$(MKDIR_P) $(BINDIR)
	for f in $(INSTALL_LIST); do \
		cp $$f $(BINDIR)/$$f && chmod 755 $(BINDIR)/$$f; \
	done

uninstall:
	for f in $(INSTALL_LIST); do \
		rm -f $(BINDIR)/$$f; \
	done

clean:
	rm -f oprofiled *.o oprofiled-src.html 

CFLAGS=-Wall -Wstrict-prototypes -O2 -pipe -Wstrict-prototypes -Wunused -W -Wshadow -Wmissing-prototypes -Winline @CFLAGS@
LIBS=@extra_libraries@ -lpopt
INCLUDES=-I. @extra_includes@
HEADERS=oprofiled.h opd_util.h ../op_user.h ../version.h
SOURCES=oprofiled.c opd_util.c opd_proc.c
EVENTS_OBJS=../events/op_events.o ../events/op_events_desc.o

srcdoc: oprofiled-src.html

oprofiled-src.html: $(SOURCES)
	../scripts/dodoc -html $(SOURCES) >oprofiled-src.html

oprofiled: $(SOURCES) $(EVENTS_OBJS) $(HEADERS)
	$(CC) $(CFLAGS) $(INCLUDES) -g -o $@ $(SOURCES) $(EVENTS_OBJS) $(LIBS)
